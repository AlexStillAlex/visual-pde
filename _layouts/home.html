<!DOCTYPE html>
<html lang="{{ page.lang | default: site.lang | default: "en" }}">

  {%- include head.html -%}
  <link rel="stylesheet" href="{{ '/assets/css/home.css' | relative_url }}">

  <body>

    {%- include header.html -%}

    <div class="home-banner">
      <div id="sim-placeholder" class="no-select"></div>
      <iframe id="sim" src="/sim/?preset=GrayScottGlidersAdvectingPeriodic&clean" style="visibility:hidden"></iframe>
      <img class="logo" src="/assets/images/logo_title_white.webp">
      <div class='home-banner-content no-select'>
        <p class='home-banner-subtitle'>Interactive solutions of PDE systems</p>
        <p class='home-banner-title'>live on your device.</p>
        <p id="try-clicking">Try clicking <i class="fa-solid fa-arrow-right-long pulse" style="position:relative;left:3px;top:2px;"></i></p>
      </div>
    </div>
    <main class="page-content" aria-label="Content">
      <div class="wrapper">

        {{ content }}

      </div>
      <div class="links-wrapper">
        <a class="button" href="/sim/">Simulate</a>
        <a class="button" href="/explore">Explore</a>
      </div>
    </main>

    {%- include mathjax.html -%}

  </body>

  <script type="text/javascript">
    function revealNav() {
      document.getElementsByClassName("links-wrapper")[0].style.opacity = 1;
      document.getElementsByClassName("site-header")[0].style.opacity = 1;
      document.getElementsByClassName("logo")[0].style.opacity = 0;
    }
    if (window.sessionStorage.getItem("visitedThisSession")) {
      revealNav();
    }
    window.sessionStorage.setItem("visitedThisSession", true);
    
    document.querySelector("iframe").addEventListener("load", function(e) {
      this.style.visibility = "visible";
      document.getElementById("sim").contentWindow.document.getElementById("play").click();
      document.getElementById("sim-placeholder").style.opacity = 0;
      if (!window.localStorage.getItem("clickedOnHome") && document.getElementsByClassName("logo")[0].getBoundingClientRect().bottom + 5 < 
        document.getElementsByClassName("home-banner-subtitle")[0].getBoundingClientRect().top) {
        document.getElementsByClassName("logo")[0].style.opacity = 1;
      }
      setTimeout(function() {
        document.getElementsByClassName("home-banner-subtitle")[0].style.opacity = 1;
      }, 1000);
      setTimeout(function() {
        document.getElementsByClassName("home-banner-title")[0].style.opacity = 1;
      }, 2000);
      const revealTime = window.localStorage.getItem("clickedOnHome") ? 0 : 10000;
      setTimeout(revealNav, revealTime);
      const tryClickingTimer = setTimeout(function() {
        document.getElementById("try-clicking").style.opacity = 1;
      }, 4000);
      $("#sim").contents().one("pointerdown touchstart", function() {
        clearTimeout(tryClickingTimer);
        document.getElementById("try-clicking").style.opacity = 0;
        setTimeout(revealNav, 1500);
        window.localStorage.setItem("clickedOnHome", true);
      });
    });
  </script>

</html>
